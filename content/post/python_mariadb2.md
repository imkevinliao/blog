---
title: "python_mariadb2"
date: 2022-08-11T16:59:05+08:00
draft: false
---
# 书接上回
代码写多了就会发现，单纯的写很简单，难的是写出来的代码够优雅并且容易维护。是的，基于代码维护的考虑，才有了接下来新代码。

之前有提到过，原来的代码还存在一些问题，具体的问题如下：

1. 维护困难
2. 源数据中诗部分采用的是繁体中文，所以增加了简繁转换功能
3. 效率问题

# 起承转合
Q1:维护的问题，也就是一直以来思考的代码优雅之道，直接写很简单，难的是后续的维护。维护关系到一个月后自己是否还能读懂

Q2:关于简繁转换，看了一些库最后决定用opencc，其实用什么不重要，重要的是这个影响了我对于表结构的思考。起初想的是将源数据和简体化后的数据一同保存为同一条记录，但是后来发现，原来不止是诗歌内容是繁体，连标题和作者都是繁体字，然后我就呆住了，我当然可以多加几个字段，这是最简单的方式，但是我放弃了。对源数据的完整保存我认为是非常必要的，所以我当时一直思考的是必须保留源数据。直到在优化代码的时候，我想到了过度封装，忽然就释然了。从实际使用角度来看，我不会去看繁体的诗词，所以不妨直接配置一个简繁开关，也不去想太多。

Q3：以前写爬虫的时候，我记得最多也就是一张表爬了两三万条数据吧，一般一张表六七千。之前做爬虫还遇到过sql注入的问题，从那之后我就学会了数据库插入的新写法，这个习惯也保留至今。在插入数据前查询是否存在，如果不存在则插入，但是当表中的数据量达到十万级别的时候，每一次插入都要进行检查效率太低了，在提高效率上，开始了新一轮的思考。

Q3:为什么要一次插入一条数据呢？于是乎我开始改写代码，一次插入多条，使用execute，折腾半天才知道应该使用executemany。如果有个人和我提一嘴可以省去我不知道多少走错路的时间。当我使用executemany时候出现了问题，报错提示我不能运行这个命令，Google了半天，还是一无所获，于是只能去看mariadb的API文档说明，顺便把其他可能涉及到的API也都看了一遍，于是才有了眉目。
